@model List<EducationPortal.Web.Models.Enrollment>

@{
    ViewData["Title"] = "Kayıtlar";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml"; 
}

<div class="container-fluid">
    <h1 class="h3 mb-4 text-gray-800">Kayıtlar</h1>

    <div class="card shadow mb-4">
        <div class="card-header py-3 d-flex justify-content-between align-items-center">
            <h6 class="m-0 font-weight-bold text-primary">Öğrenci - Ders Kayıt Listesi</h6>
        </div>

        <div class="card-body">
            @if (Model == null || !Model.Any())
            {
                <div class="alert alert-info">
                    Sistemde henüz herhangi bir kayıt bulunmamaktadır.
                </div>
            }
            else
            {
                <table class="table table-bordered table-hover">
                    <thead class="thead-light">
                        <tr>
                            <th>Öğrenci Adı</th>
                            <th>Öğrenci E-posta</th>
                            <th>Ders Adı</th>
                            <th>Kredi</th>
                            <th>Kategori</th>
                            <th>İşlemler</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var e in Model)
                        {
                            <tr>
                                <td>@e.User?.FullName</td>
                                <td>@e.User?.Email</td>
                                <td>@e.Course?.Title</td>
                                <td>@e.Course?.Credits</td>
                                <td>@e.Course?.CourseCategory?.Name</td>
                                <td>
                                    <form asp-action="Delete"
                                          asp-controller="Enrollment"
                                          method="post"
                                          class="d-inline"
                                          onsubmit="return confirm('Bu kaydı silmek istediğinize emin misiniz?');">
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="id" value="@e.EnrollmentId" />
                                        <button type="submit" class="btn btn-danger btn-sm">
                                            <i class="fas fa-trash-alt"></i> Sil
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
        </div>
    </div>
</div>


@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Silme butonlarına tıklama olayını dinle
            const deleteButtons = document.querySelectorAll('.delete-btn');

            deleteButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault(); // Normal form gönderimini engelle

                    const form = this.closest('form');
                    const row = this.closest('tr');
                    const studentName = row.cells[0].textContent.trim();
                    const courseName = row.cells[1].textContent.trim();

                    Swal.fire({
                        title: 'Emin misiniz?',
                        html: `<strong>"${studentName}"</strong> öğrencisinin <strong>"${courseName}"</strong> dersindeki kaydını silmek istediğinizden emin misiniz?`,
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#d33',
                        cancelButtonColor: '#3085d6',
                        confirmButtonText: 'Evet, sil!',
                        cancelButtonText: 'İptal',
                        reverseButtons: true,
                        customClass: {
                            confirmButton: 'btn btn-danger',
                            cancelButton: 'btn btn-secondary'
                        },
                        buttonsStyling: false,
                        width: '500px'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            // Eğer kullanıcı evet derse formu gönder
                            form.submit();
                        }
                    });
                });
            });

            // Başarı mesajlarını otomatik kapat (5 saniye sonra)
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
                setTimeout(() => {
                    if (alert.parentNode) {
                        alert.style.opacity = '0';
                        setTimeout(() => {
                            if (alert.parentNode) {
                                alert.remove();
                            }
                        }, 300);
                    }
                }, 5000);
            });
        });
    </script>

    <style>
        .swal2-popup {
            font-size: 1rem;
            border-radius: 10px;
        }

        .swal2-title {
            font-size: 1.3rem;
            color: #d33;
        }

        .btn {
            margin: 0 5px;
            padding: 8px 20px;
            border-radius: 5px;
            font-weight: 500;
        }

        .alert {
            transition: opacity 0.3s ease;
        }
    </style>
}